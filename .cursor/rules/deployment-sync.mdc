---
description: 
globs: 
alwaysApply: false
---
# Deployment Documentation Sync Rules

## üîÑ File Synchronization Requirements

### Primary Sources of Truth
- **deployment-config.json**: Authoritative configuration values and URLs
- **DEPLOYMENT.md**: Comprehensive deployment guide and procedures
- **.github/workflows/azure-functions-deploy.yml**: Active deployment pipeline

### Mandatory Sync Rules

#### When deployment-config.json Changes:
1. **MUST update DEPLOYMENT.md** to reflect new configuration values
2. **MUST verify GitHub workflow** uses correct app names and URLs
3. **MUST update cursor deployment rules** if resource names change
4. **MUST test all URLs** and endpoints in documentation

#### When DEPLOYMENT.md Changes:
1. **MUST verify consistency** with deployment-config.json values
2. **MUST ensure accuracy** of all Azure resource names and URLs
3. **MUST validate** all curl commands and examples use correct endpoints
4. **MUST update last modified date** at bottom of file

#### When GitHub Workflow Changes:
1. **MUST update DEPLOYMENT.md** Method 3 section to match pipeline changes
2. **MUST verify app names** match deployment-config.json
3. **MUST document new secrets** or authentication methods
4. **MUST update pipeline stage descriptions** if workflow structure changes

## üìã Required Consistency Checks

### Azure Resource Names (Must Match Across All Files)
- **Function App Name**: `hustlemode-api`
- **Resource Group**: `hustlemode.ai`
- **App URL**: `https://hustlemode-api.azurewebsites.net/`
- **Kudu SCM URL**: `https://hustlemode-api.scm.azurewebsites.net/`
- **Location**: `eastus`

### WhatsApp Configuration (Must Match Across All Files)
- **Phone Number**: `+15556583575`
- **Webhook URL**: `https://hustlemode-api.azurewebsites.net/api/messaging/whatsapp`
- **Verify Token**: `fa22d4e7-cba4-48cf-9b36-af6190bf9c67`
- **Business Account ID**: `715387334407630`
- **Phone Number ID**: `682917338218717`

### GitHub Secrets (Must Be Documented)
- **Current Secret**: `AZUREAPPSERVICE_PUBLISHPROFILE_FFEB2282094642A1A8B5E3AFAE67C0DC`
- **Purpose**: Azure Functions publish profile for deployment authentication
- **Usage**: GitHub Actions workflow deployment stage

## üö´ Prohibited Inconsistencies

### Never Allow These Mismatches:
- ‚ùå Different app names between deployment-config.json and workflow
- ‚ùå Different URLs between DEPLOYMENT.md and deployment-config.json
- ‚ùå Outdated pipeline descriptions in DEPLOYMENT.md
- ‚ùå Missing or incorrect secret names in documentation
- ‚ùå Wrong resource group names across files
- ‚ùå Inconsistent WhatsApp configuration values

### Validation Requirements:
- ‚úÖ All URLs in DEPLOYMENT.md must match deployment-config.json
- ‚úÖ All Azure resource names must be consistent across files
- ‚úÖ GitHub workflow app names must match deployment-config.json
- ‚úÖ All curl examples must use correct endpoints
- ‚úÖ Documentation must reflect current pipeline architecture

## üîß Update Procedures

### When Azure Configuration Changes:
1. **Update deployment-config.json** first (source of truth)
2. **Update .github/workflows/azure-functions-deploy.yml** to match
3. **Update DEPLOYMENT.md** with new values and test commands
4. **Update .cursor/rules/deployment.mdc** if resource names change
5. **Test all documented commands** with new configuration
6. **Update last modified dates** in all affected files

### When Pipeline Architecture Changes:
1. **Update .github/workflows/azure-functions-deploy.yml** first
2. **Update DEPLOYMENT.md Method 3 section** to describe new pipeline
3. **Update deployment-config.json deployment.methods** if applicable
4. **Document any new secrets** or authentication methods
5. **Test complete pipeline** end-to-end

### When WhatsApp Configuration Changes:
1. **Update deployment-config.json whatsapp section** first
2. **Update DEPLOYMENT.md WhatsApp Configuration section**
3. **Update all webhook URLs** and test commands
4. **Verify Meta for Developers setup** instructions are current
5. **Test webhook verification** with new configuration

## üìù Mandatory Documentation Standards

### DEPLOYMENT.md Requirements:
- Must include current date in "Last Updated" footer
- All curl commands must be copy-paste ready with correct URLs
- Pipeline description must match current GitHub workflow structure
- All Azure resource names must match deployment-config.json exactly
- GitHub secrets section must list current secret names

### deployment-config.json Requirements:
- Must be valid JSON at all times
- All URLs must be fully qualified and accessible
- Status fields must reflect current deployment state
- Last_updated field must be current
- All configuration values must match production environment

## üêç Python Packaging Requirements for Azure Functions

### Mandatory Package Structure:
- **MUST create `.python_packages/lib/site-packages/` directory** in deployment package
- **MUST install all dependencies** using `pip install -r requirements.txt --target .python_packages/lib/site-packages`
- **NEVER use virtual environments** in GitHub Actions build step for Azure Functions
- **ALWAYS include** .python_packages directory in deployment ZIP

### Build Step Requirements:
```yaml
- name: 'Install dependencies'
  run: |
    cd ${{ env.AZURE_FUNCTIONAPP_PACKAGE_PATH }}
    mkdir -p .python_packages/lib/site-packages
    pip install -r requirements.txt --target .python_packages/lib/site-packages
```

### Package Validation Rules:
- ‚úÖ Deployment ZIP must contain `.python_packages/lib/site-packages/` with all dependencies
- ‚úÖ Azure Functions runtime must find packages in expected location
- ‚úÖ No virtual environment directories (venv/) in deployment package
- ‚ùå Never install packages to system or virtual environment for deployment
- ‚ùå Never rely on Azure Functions remote build for critical dependencies

### Cross-Platform Considerations:
- Install packages for Linux platform: `--platform linux_x86_64 --only-binary=:all:`
- Use `--no-compile` flag to avoid bytecode compilation issues
- For native dependencies, prefer wheels over source compilation

## üéØ Quality Assurance Rules

### Before Any Deployment Documentation Update:
1. **Cross-reference all three files** for consistency
2. **Test all documented URLs** and endpoints
3. **Verify GitHub workflow** uses correct configuration
4. **Check Azure Portal** matches documented configuration
5. **Validate all examples** work with current setup

### Required Verification Steps:
- [ ] deployment-config.json values match Azure Portal
- [ ] DEPLOYMENT.md URLs match deployment-config.json
- [ ] GitHub workflow app names match deployment-config.json
- [ ] All curl examples use correct endpoints
- [ ] Pipeline description matches current workflow
- [ ] Last updated dates are current

## üö® Critical Synchronization Points

### These Changes Require Full Documentation Sync:
- Azure Function App name changes
- Resource group changes
- GitHub secret rotation
- Pipeline architecture modifications
- WhatsApp webhook URL changes
- Azure OpenAI endpoint changes

### Auto-Sync Triggers:
- Any edit to deployment-config.json ‚Üí Review DEPLOYMENT.md
- Any edit to DEPLOYMENT.md ‚Üí Verify against deployment-config.json
- Any workflow file changes ‚Üí Update DEPLOYMENT.md Method 3
- Any Azure resource changes ‚Üí Update all three files

---
**Purpose**: Ensure deployment documentation accuracy and consistency  
**Impact**: Prevents deployment failures due to outdated documentation  
**Frequency**: Every deployment-related change requires sync verification
